{"version":3,"sources":["multi_touch_event.es6"],"names":[],"mappings":"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","file":"multi_touch_event-compiled.js","sourcesContent":["/**\n * Created by beens on 16/8/2.\n */\n\n\n//双指缩放、旋转 （监听的window对象）\n//new DEVICE.mulit_touch_evnet({\n//    maxScale:4,         //最大放大到倍数\n//    minScale:0.25,      //最大缩小到倍数\n//    //执行函数，回传缩放大小和度数  最好只用1个，同时执行体验不好未做处理\n//    changeFn:function(scale,deg){\n//        $(\"#test\").css3({\n//            transform:\"scale(\"+scale+\") rotate(\"+deg+\"deg)\"\n//        })\n//    }\n//});\n\n\n\nDEVICE.mulit_touch_evnet = class multiTouchEvent{\n    constructor(opt){\n        this.changeFn= opt.changeFn || function(){};\n\n        //this.startRotateDeg = 5;\n        //this.startZoomLength = 10;\n        this.touchBeforeMoveNumber = 0;        //手指移动前触摸的数量\n        this.startPoints = null;\n        this.points = [];\n        this.angleFn = DEVICE.angle;\n\n        this.deg = 0;\n        this.scale = 1;\n        this.maxScale = opt.maxScale || 4;\n        this.minScale = opt.minScale || 0.25;\n\n        this._addEvent();\n    }\n\n    _addEvent(){\n        window.addEventListener(DEVICE.START_EV,(e)=>{\n            e = e.touches || e;\n            this._startEvent(e);\n        },false);\n        window.addEventListener(DEVICE.MOVE_EV,(e)=>{\n            e.preventDefault();\n            e = e.touches || e;\n            this._moveEvent(e);\n        },false);\n        window.addEventListener(DEVICE.END_EV,(e)=>{\n            e = e.touches || e;\n            this._endEvent(e);\n        },false);\n        window.addEventListener(DEVICE.CANCEL_EV,(e)=>{\n            e = e.touches || e;\n            this._endEvent(e);\n        },false);\n    }\n\n    _startEvent(e){\n        this._savePoint(e);\n\n\n    }\n    _moveEvent(e){\n        if(this.touchBeforeMoveNumber == 0){\n            this.touchBeforeMoveNumber = e.length;\n            this.startPoints = this.points[this.points.length - 1];\n        }\n\n\n        this._savePoint(e);\n\n        if(e.length == 2 && this.touchBeforeMoveNumber == 2){\n            //判断是缩放还是旋转\n            this._handler2Touches();\n        }\n\n\n    }\n    _endEvent(e){\n        //获取到的是点击时的点的位置\n\n        //手指全部离开\n        if(e.length == 0){\n            this._delPoint();\n        }else{\n            this._savePoint(e);\n        }\n    }\n\n\n    _savePoint(e){\n        var new_e = JSON.parse(JSON.stringify(e));\n        this.points.push(new_e);\n    }\n    _delPoint(){\n        this.points = [];\n        this.startPoints = null;\n        this.touchBeforeMoveNumber = 0;\n    }\n\n    _handler2Touches(){\n        if(this.points.length < 2){return;}\n\n        let points = this.points,\n            //startPoints = this.startPoints,\n            startPoints = points[points.length-2],\n            endPoints = points[points.length-1];\n\n        if(startPoints.length != 2 || endPoints.length != 2 ){\n            return;\n        }\n\n        let abs = Math.abs,\n            sqrt = Math.sqrt,\n            s1_x = startPoints[0].screenX,  //起始点1\n            s1_y = startPoints[0].screenY,\n            s2_x = startPoints[1].screenX,  //起始点2\n            s2_y = startPoints[1].screenY,\n            e1_x = endPoints[0].screenX,    //结束点1\n            e1_y = endPoints[0].screenY,\n            e2_x = endPoints[1].screenX,    //结束点2\n            e2_y = endPoints[1].screenY,\n            c_x = s1_x + (s2_x - s1_x)/2,   //中心点1\n            c_y = s1_y + (s2_y - s1_y)/2,\n            s_l = sqrt((s1_x - s2_x)*(s1_x - s2_x) + (s1_y - s2_y)*(s1_y - s2_y)),\n            e_l = sqrt((e1_x - e2_x)*(e1_x - e2_x) + (e1_y - e2_y)*(e1_y - e2_y)),\n            //2指前后移动距离差\n            move = e_l - s_l,\n            //手指1移动的角度\n            deg1 = this.angleFn({x:s1_x,y:s1_y},{x:c_x,y:c_y},{x:e1_x,y:e1_y}),\n            deg2 = this.angleFn({x:s2_x,y:s2_y},{x:c_x,y:c_y},{x:e2_x,y:e2_y}),\n            touch1IsClockwise = this._clockwise({x:s1_x,y:s1_y},{x:c_x,y:c_y},{x:e1_x,y:e1_y}),\n            touch2IsClockwise = this._clockwise({x:s1_x,y:s1_y},{x:c_x,y:c_y},{x:e1_x,y:e1_y});\n\n\n        let scale = ( move >= 0)? this.scale + move/100 : this.scale + move/100;\n        scale = DEVICE.getBetweenNumber(scale,this.minScale,this.maxScale);\n        this.scale = scale;\n\n\n        let deg = (deg1 > deg2)? deg1 : deg2;\n        if(touch1IsClockwise == touch2IsClockwise){\n            deg = (touch1IsClockwise)? deg : -deg;\n            deg = this.deg + deg;\n            this.deg = deg;\n        }else{\n            deg = this.deg;\n        }\n\n        this.changeFn(scale,deg);\n\n        //console.log(touch1IsClockwise+\" \"+touch2IsClockwise)\n    }\n\n    //判断向量p2p3 是否在向量p2p1的顺时针 （三角形的三点）\n    _clockwise(p1,p2,p3){\n        var dx1 = p1.x - p2.x,\n            dy1 = p1.y - p2.y,\n            dx2 = p3.x - p2.x,\n            dy2 = p3.y - p2.y,\n            dx = dx1*dy2 - dx2*dy1;\n\n        return (dx>0);\n\n    }\n\n\n};\n\n"]}
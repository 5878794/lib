{"version":3,"sources":["multi_touch_event.es6"],"names":[],"mappings":"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","file":"multi_touch_event-compiled.js","sourcesContent":["/**\n * Created by beens on 16/8/2.\n */\n\n\n//双指缩放、旋转 （监听的window对象）\n//new DEVICE.mulit_touch_evnet({\n//    maxScale:4,         //最大放大到倍数\n//    minScale:0.25,      //最大缩小到倍数\n//    //执行函数，回传缩放大小和度数  最好只用1个，同时执行体验不好未做处理\n//    changeFn:function(scale,deg){\n//        $(\"#test\").css3({\n//            transform:\"scale(\"+scale+\") rotate(\"+deg+\"deg)\"\n//        })\n//    }\n//});\n\n\n\nDEVICE.mulit_touch_evnet = class multiTouchEvent{\n    constructor(opt){\n        this.changeFn= opt.changeFn || function(){};\n\n        //this.startRotateDeg = 5;\n        //this.startZoomLength = 10;\n        this.touchBeforeMoveNumber = 0;        //手指移动前触摸的数量\n        this.startPoints = null;\n        this.points = [];\n        this.angleFn = DEVICE.angle;\n\n        this.deg = 0;\n        this.scale = 1;\n        this.maxScale = opt.maxScale || 4;\n        this.minScale = opt.minScale || 0.25;\n\n        this._addEvent();\n    }\n\n    _addEvent(){\n        window.addEventListener(DEVICE.START_EV,(e)=>{\n            e = e.touches || e;\n            this._startEvent(e);\n        },false);\n        window.addEventListener(DEVICE.MOVE_EV,(e)=>{\n            e.preventDefault();\n            e = e.touches || e;\n            this._moveEvent(e);\n        },false);\n        window.addEventListener(DEVICE.END_EV,(e)=>{\n            e = e.touches || e;\n            this._endEvent(e);\n        },false);\n        window.addEventListener(DEVICE.CANCEL_EV,(e)=>{\n            e = e.touches || e;\n            this._endEvent(e);\n        },false);\n    }\n\n    _startEvent(e){\n        this._savePoint(e);\n\n\n    }\n    _moveEvent(e){\n        if(this.touchBeforeMoveNumber == 0){\n            this.touchBeforeMoveNumber = e.length;\n            this.startPoints = this.points[this.points.length - 1];\n        }\n\n\n        this._savePoint(e);\n\n        if(e.length == 2 && this.touchBeforeMoveNumber == 2){\n            //判断是缩放还是旋转\n            this._handler2Touches();\n        }\n\n\n    }\n    _endEvent(e){\n        //获取到的是点击时的点的位置\n\n        //手指全部离开\n        if(e.length == 0){\n            this._delPoint();\n        }else{\n            this._savePoint(e);\n        }\n    }\n\n\n    _savePoint(e){\n        var new_e = JSON.parse(JSON.stringify(e));\n        this.points.push(new_e);\n    }\n    _delPoint(){\n        this.points = [];\n        this.startPoints = null;\n        this.touchBeforeMoveNumber = 0;\n    }\n\n    _handler2Touches(){\n        if(this.points.length < 2){return;}\n\n        let points = this.points,\n            //startPoints = this.startPoints,\n            startPoints = points[points.length-2],\n            endPoints = points[points.length-1];\n\n        if(startPoints.length != 2 || endPoints.length != 2 ){\n            return;\n        }\n\n        let abs = Math.abs,\n            sqrt = Math.sqrt,\n            s1_x = startPoints[0].screenX,  //起始点1\n            s1_y = startPoints[0].screenY,\n            s2_x = startPoints[1].screenX,  //起始点2\n            s2_y = startPoints[1].screenY,\n            e1_x = endPoints[0].screenX,    //结束点1\n            e1_y = endPoints[0].screenY,\n            e2_x = endPoints[1].screenX,    //结束点2\n            e2_y = endPoints[1].screenY,\n            c_x = s1_x + (s2_x - s1_x)/2,   //中心点1\n            c_y = s1_y + (s2_y - s1_y)/2,\n            s_l = sqrt((s1_x - s2_x)*(s1_x - s2_x) + (s1_y - s2_y)*(s1_y - s2_y)),\n            e_l = sqrt((e1_x - e2_x)*(e1_x - e2_x) + (e1_y - e2_y)*(e1_y - e2_y)),\n            //2指前后移动距离差\n            move = e_l - s_l,\n            //手指1移动的角度\n            deg1 = this.angleFn({x:s1_x,y:s1_y},{x:c_x,y:c_y},{x:e1_x,y:e1_y}),\n            deg2 = this.angleFn({x:s2_x,y:s2_y},{x:c_x,y:c_y},{x:e2_x,y:e2_y}),\n            touch1IsClockwise = this._clockwise({x:s1_x,y:s1_y},{x:c_x,y:c_y},{x:e1_x,y:e1_y}),\n            touch2IsClockwise = this._clockwise({x:s1_x,y:s1_y},{x:c_x,y:c_y},{x:e1_x,y:e1_y});\n\n\n        let scale = ( move >= 0)? this.scale + move/100 : this.scale + move/100;\n        scale = DEVICE.getBetweenNumber(scale,this.minScale,this.maxScale);\n        this.scale = scale;\n\n\n        let deg = (deg1 > deg2)? deg1 : deg2;\n        if(touch1IsClockwise == touch2IsClockwise){\n            deg = (touch1IsClockwise)? deg : -deg;\n            deg = this.deg + deg;\n            this.deg = deg;\n        }else{\n            deg = this.deg;\n        }\n\n        this.changeFn(scale,deg);\n\n        //console.log(touch1IsClockwise+\" \"+touch2IsClockwise)\n    }\n\n    //判断向量p2p3 是否在向量p2p1的顺时针 （三角形的三点）\n    _clockwise(p1,p2,p3){\n        var dx1 = p1.x - p2.x,\n            dy1 = p1.y - p2.y,\n            dx2 = p3.x - p2.x,\n            dy2 = p3.y - p2.y,\n            dx = dx1*dy2 - dx2*dy1;\n\n        return (dx>0);\n\n    }\n\n\n};\n\n"]}
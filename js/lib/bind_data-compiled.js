"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}DEVICE.bindData=function(){function bindData(dom,data){_classCallCheck(this,bindData);this.dom=dom;this.data=data;this.mark={};this.repeatMark={};this._init();}_createClass(bindData,[{key:"_init",value:function _init(){this._getMark(this.dom.get(0));this.bindData(this.data);}},{key:"bindData",value:function bindData(data){data=JSON.parse(JSON.stringify(data));this._setVal(data);this._setListVal(data);}},{key:"_getMark",value:function _getMark(dom){var attr=dom.attributes||[];for(var i=0,l=attr.length;i<l;i++){var attr_name=attr[i].name,attr_value=attr[i].value,attr_mark=this._getAllMark(attr_value);if(attr_mark.length!=0){this._saveMark(attr_mark,attr_name,attr_value,dom,"attr");}}if(dom.dataset&&dom.dataset.repeat){this._saveRepeatList(dom);return;}var text=dom.nodeValue,text_mark=this._getAllMark(text);if(text_mark.length!=0){this._saveMark(text_mark,"",text,dom,"text");}var children=dom.childNodes;for(var z=0,zl=children.length;z<zl;z++){if(children[z].nodeType==1||children[z].nodeType==3){this._getMark(children[z]);}}}},{key:"_getAllMark",value:function _getAllMark(value){if(value===null){return[];}if(value.indexOf("{{")>-1&&value.indexOf("}}")>-1){return value.match(/\$\w+/ig)||[];}else{return[];}}},{key:"_saveMark",value:function _saveMark(array,attr_name,attr_value,dom,type){for(var i=0,l=array.length;i<l;i++){var key=array[i];key=key.substr(1,key.length-1);if(!this.mark[key]){this.mark[key]={value:"",items:[]};}this.mark[key].items.push({dom:dom,type:type,attrName:attr_name,value:attr_value});}}},{key:"_setVal",value:function _setVal(data){for(var key in this.mark){if(this.mark.hasOwnProperty(key)){var value=data[key]||"",obj=this.mark[key];if(obj.value!=value){obj.value=value;var doms=obj.items;for(var i=0,l=doms.length;i<l;i++){var this_data=doms[i],this_dom=this_data.dom,this_attrName=this_data.attrName,oldStr=this_data.value,newStr=this._getNewStr(oldStr,data);if(this_data.type=="attr"){this_dom.setAttribute(this_attrName,newStr);}else{this_dom.nodeValue=newStr;}}}}}}},{key:"_getNewStr",value:function _getNewStr(str,data){str=str.replace(/\{\{[a-z_\$\(][a-z0-9_\.\s\[\]\+\-\*\/\%\$\(\)]*\}\}/ig,function(a){a=a.substr(2,a.length-4);a=a.replace(/\$/g,"data.");a=eval(a);return a;});return str;}},{key:"_saveRepeatList",value:function _saveRepeatList(dom){var text=dom.dataset.repeat;text=text.split(" ");var data_key=text[3],set_key=text[1];if(!data_key||!set_key){return;}if(!this.repeatMark[data_key]){this.repeatMark[data_key]={items:[],listNumber:0,data:[]};}this.repeatMark[data_key].items.push({dom:dom,list:dom.innerHTML,setKey:set_key});$(dom).html("");}},{key:"_setListVal",value:function _setListVal(data){for(var key in this.repeatMark){if(this.repeatMark.hasOwnProperty(key)){var data_source=data[key]||[],data_length=data_source.length,this_item=this.repeatMark[key],items=this_item.items||[],old_number=this_item.listNumber,now_number=data_length,old_data=JSON.stringify(this_item.data),now_data=JSON.stringify(data_source);if(old_data==now_data){continue;}this.repeatMark[key].listNumber=now_number;this.repeatMark[key].data=data_source;for(var i=0,l=items.length;i<l;i++){var _data=items[i],_body=_data.dom,_key=_data.setKey,_html=_data.list,z=0;if(old_number>=now_number){$(_body).html("");}else{z=old_number;}for(z,data_length;z<data_length;z++){var __data={};__data[_key]=data_source[z];var this_html=this._getNewStr(_html,__data);$(_body).append(this_html);}}}}}}]);return bindData;}();

//# sourceMappingURL=bind_data-compiled.js.map
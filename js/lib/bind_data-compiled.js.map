{"version":3,"sources":["bind_data.es6"],"names":[],"mappings":"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","file":"bind_data-compiled.js","sourcesContent":["\n\n\n//TODO 只写了模板赋值单向绑定 双向绑定需要检查this.data对象的key  数据循环未处理\n//\n\n\nDEVICE.bindData = class bindData{\n    constructor(dom,data){\n        this.dom = dom;\n        this.data = data;\n\n        this.mark = {};\n\n        this._init();\n    }\n\n    _init(){\n        this._getMark(this.dom.get(0));\n        this._setVal(this.data);\n\n        console.log(this.mark)\n    }\n\n    //解析模板\n    _getMark(dom){\n        //if(dom.length == 0){return;}\n\n        //处理元素的attr\n        let attr = dom.attributes || [];\n        for(var i=0,l=attr.length;i<l;i++){\n            let attr_name = attr[i].name,\n                attr_value = attr[i].value,\n                attr_mark = this._getAllMark(attr_value);\n\n            if(attr_mark.length != 0 ){\n                this._saveMark(attr_mark,attr_name,attr_value,dom,\"attr\")\n            }\n        }\n\n        //处理元素的text\n        let text = dom.nodeValue,\n            text_mark = this._getAllMark(text);\n\n        if(text_mark.length != 0 ){\n            this._saveMark(text_mark,\"\",text,dom,\"text\")\n        }\n\n\n\n        //处理子元素\n        let children = dom.childNodes;\n        for(var z=0,zl=children.length;z<zl;z++){\n            this._getMark(children[z])\n        }\n    }\n\n    //读取模板中的{{}}中的变量\n    _getAllMark(value){\n        if(value === null){return []}\n\n        if(value.indexOf(\"{{\")>-1 && value.indexOf(\"}}\")>-1){\n            return value.match(/\\$\\w+/ig);\n        }else{\n            return [];\n        }\n    }\n\n    //保存模板中的{{}}中的变量\n    _saveMark(array,attr_name,attr_value,dom,type){\n        for(var i =0 , l = array.length; i<l; i++){\n            let key = array[i];\n            key = key.substr(1,key.length-1);\n\n            if(!this.mark[key]){\n                this.mark[key] = {\n                    value:\"\",\n                    items:[]\n                };\n            }\n\n            this.mark[key].items.push({\n                dom:dom,\n                type:type,\n                attrName:attr_name,\n                value:attr_value\n            })\n\n        }\n    }\n\n    //赋值\n    _setVal(data){\n        for(var key in this.mark){\n            if(this.mark.hasOwnProperty(key)){\n                let value = data[key] || \"\",\n                    obj = this.mark[key];\n\n                if(obj.value != value){\n                    obj.value = value;\n                    let doms = obj.items;\n                    for(var i=0,l=doms.length;i<l;i++){\n                        let this_data = doms[i],\n                            this_dom = this_data.dom,\n                            this_attrName = this_data.attrName,\n                            oldStr = this_data.value,\n                            newStr = this._getNewStr(oldStr,data);\n\n                        if(this_data.type==\"attr\"){\n                            this_dom.setAttribute(this_attrName,newStr);\n                        }else{\n                            this_dom.nodeValue = newStr;\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    //模板字符串转换为实际的字符串\n    _getNewStr(str,data){\n        str = str.replace(/\\{\\{[a-z_\\$\\(][a-z0-9_\\.\\s\\[\\]\\+\\-\\*\\/\\%\\$\\(\\)]*\\}\\}/ig,function(a){\n            a = a.substr(2,a.length-4);\n            a = a.replace(/\\$/g,\"data.\");\n            a = eval(a);\n            return a;\n        });\n\n        return str;\n    }\n};\n\n\n"]}